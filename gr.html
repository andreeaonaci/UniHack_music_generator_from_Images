<!-- map_html variable (multi-line string in Python) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
 integrity="sha256-sA+g6l7r1k5bKQb3ZLP3s1JQkqg3Y1Phk9n7f0kCm78=" crossorigin=""/>
<div id="map" style="width:100%; height:480px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.15)"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const markers = MARKERS_DATA_PLACEHOLDER; // will be replaced from Python

  // center Romania
  const map = L.map('map', {zoomControl: true}).setView([45.94, 24.97], 7);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
  }).addTo(map);

  // custom icon (simple)
  const icon = L.icon({
    iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png', // small pin
    iconSize: [28, 28],
    iconAnchor: [14, 28],
    popupAnchor: [0, -28],
  });

  // add markers
  markers.forEach(m => {
    const marker = L.marker([m.lat, m.lon], {icon}).addTo(map);
    const imgHtml = m.image ? `<img src="${m.image}" style="width:120px;border-radius:8px;margin-bottom:8px;display:block;">` : "";
    const popupHtml = `
      <div style="text-align:left;max-width:220px;">
        ${imgHtml}
        <strong>${m.name}</strong>
        <p style="font-size:12px;color:#333;margin:8px 0;">${m.desc ? m.desc.substring(0,200) + (m.desc.length>200?'...':'') : ''}</p>
        <button onclick="selectMonument('${m.name.replace(/'/g, "\\'")}')" style="background:#4B0082;color:white;border:none;padding:8px 10px;border-radius:8px;cursor:pointer;">Select</button>
      </div>
    `;
    marker.bindPopup(popupHtml, {maxWidth:240});
  });

  // function to call back into Python / Gradio
  function selectMonument(name) {
    // gradio `window` function to set input element (dropdown). We'll dispatch a custom event that Gradio can handle.
    // Simpler approach: set value of dropdown input if it has id.
    // We'll try to find a select element with the label text "SelecteazÄƒ monument" and set its value - but Gradio markup differs.
    // Instead, emit a custom DOM event and rely on a small JS callback in the Gradio app to listen to it.
    const event = new CustomEvent("selectMonument", {detail: {name}});
    window.dispatchEvent(event);
  }
</script>
